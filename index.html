<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beast Traffic - Authentication</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const API_URL = 'https://beast-auth-api.vercel.app/api'; // Update with your Vercel API URL

    function App() {
      const [mode, setMode] = useState('login');
      const [theme, setTheme] = useState('dark');
      const [token, setToken] = useState(localStorage.getItem('token') || '');
      const [isAdmin, setIsAdmin] = useState(false);
      const [username, setUsername] = useState('');

      useEffect(() => {
        document.body.className = theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-900';
        if (token) {
          fetch(`${API_URL}/validate-token`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token })
          })
            .then(res => res.json())
            .then(data => {
              if (data.username) {
                setUsername(data.username);
                setIsAdmin(data.isAdmin);
                setMode('welcome');
              } else {
                localStorage.removeItem('token');
                setToken('');
              }
            })
            .catch(() => {
              localStorage.removeItem('token');
              setToken('');
            });
        }
      }, [theme, token]);

      const toggleTheme = () => {
        setTheme(theme === 'dark' ? 'light' : 'dark');
      };

      const handleLogout = () => {
        fetch(`${API_URL}/logout`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${token}` }
        })
          .then(() => {
            localStorage.removeItem('token');
            setToken('');
            setMode('login');
            setUsername('');
            setIsAdmin(false);
          })
          .catch(err => console.error('Logout error:', err));
      };

      return (
        <div className="container mx-auto p-4 max-w-md">
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-2xl font-bold">Beast Traffic</h1>
            <button
              onClick={toggleTheme}
              className="p-2 rounded bg-blue-600 hover:bg-blue-700"
            >
              {theme === 'dark' ? 'â˜€ Light' : 'ðŸŒ™ Dark'}
            </button>
          </div>
          {mode === 'welcome' && (
            <Welcome
              username={username}
              isAdmin={isAdmin}
              setMode={setMode}
              handleLogout={handleLogout}
            />
          )}
          {mode === 'login' && (
            <Login setToken={setToken} setUsername={setUsername} setIsAdmin={setIsAdmin} setMode={setMode} />
          )}
          {mode === 'signup' && (
            <Signup setMode={setMode} />
          )}
          {mode === 'admin' && (
            <AdminPanel token={token} setMode={setMode} />
          )}
        </div>
      );
    }

    function Welcome({ username, isAdmin, setMode, handleLogout }) {
      return (
        <div className="text-center">
          <h2 className="text-xl mb-4">Welcome, {username}!</h2>
          <p className="mb-4">Access Beast Traffic Automation Suite for only â‚¹1999!</p>
          <div className="flex flex-col gap-4">
            <button
              onClick={() => setMode('login')}
              className="p-2 bg-blue-600 rounded hover:bg-blue-700"
            >
              Back to Login
            </button>
            {isAdmin && (
              <button
                onClick={() => setMode('admin')}
                className="p-2 bg-green-600 rounded hover:bg-green-700"
              >
                Admin Panel
              </button>
            )}
            <button
              onClick={handleLogout}
              className="p-2 bg-red-600 rounded hover:bg-red-700"
            >
              Logout
            </button>
          </div>
        </div>
      );
    }

    function Login({ setToken, setUsername, setIsAdmin, setMode }) {
      const [username, setUsernameInput] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleLogin = () => {
        fetch(`${API_URL}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        })
          .then(res => res.json())
          .then(data => {
            if (data.token) {
              localStorage.setItem('token', data.token);
              setToken(data.token);
              setUsername(data.username);
              setIsAdmin(data.isAdmin);
              setMode('welcome');
            } else {
              setError(data.error || 'Login failed');
            }
          })
          .catch(() => setError('Server error'));
      };

      return (
        <div>
          <h2 className="text-xl mb-4 text-center">Login</h2>
          {error && <p className="text-red-500 mb-4">{error}</p>}
          <input
            type="text"
            placeholder="Username"
            value={username}
            onChange={e => setUsernameInput(e.target.value)}
            className="w-full p-2 mb-4 bg-gray-800 rounded text-white"
          />
          <input
            type="password"
            placeholder="Password"
            value={password}
            onChange={e => setPassword(e.target.value)}
            className="w-full p-2 mb-4 bg-gray-800 rounded text-white"
          />
          <button
            onClick={handleLogin}
            className="w-full p-2 bg-blue-600 rounded hover:bg-blue-700"
          >
            Login
          </button>
          <p className="mt-4 text-center">
            Don't have an account?{' '}
            <span
              onClick={() => setMode('signup')}
              className="text-blue-400 cursor-pointer"
            >
              Sign Up
            </span>
          </p>
        </div>
      );
    }

    function Signup({ setMode }) {
      const [username, setUsername] = useState('');
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleSignup = () => {
        fetch(`${API_URL}/signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, email, password })
        })
          .then(res => res.json())
          .then(data => {
            if (data.message) {
              setMode('login');
            } else {
              setError(data.error || 'Signup failed');
            }
          })
          .catch(() => setError('Server error'));
      };

      return (
        <div>
          <h2 className="text-xl mb-4 text-center">Sign Up</h2>
          {error && <p className="text-red-500 mb-4">{error}</p>}
          <input
            type="text"
            placeholder="Username"
            value={username}
            onChange={e => setUsername(e.target.value)}
            className="w-full p-2 mb-4 bg-gray-800 rounded text-white"
          />
          <input
            type="email"
            placeholder="Email"
            value={email}
            onChange={e => setEmail(e.target.value)}
            className="w-full p-2 mb-4 bg-gray-800 rounded text-white"
          />
          <input
            type="password"
            placeholder="Password"
            value={password}
            onChange={e => setPassword(e.target.value)}
            className="w-full p-2 mb-4 bg-gray-800 rounded text-white"
          />
          <button
            onClick={handleSignup}
            className="w-full p-2 bg-blue-600 rounded hover:bg-blue-700"
          >
            Sign Up
          </button>
          <p className="mt-4 text-center">
            Already have an account?{' '}
            <span
              onClick={() => setMode('login')}
              className="text-blue-400 cursor-pointer"
            >
              Login
            </span>
          </p>
        </div>
      );
    }

    function AdminPanel({ token, setMode }) {
      const [users, setUsers] = useState([]);
      const [error, setError] = useState('');

      useEffect(() => {
        fetch(`${API_URL}/admin/users`, {
          headers: { 'Authorization': `Bearer ${token}` }
        })
          .then(res => res.json())
          .then(data => {
            if (Array.isArray(data)) {
              setUsers(data);
            } else {
              setError(data.error || 'Failed to fetch users');
            }
          })
          .catch(() => setError('Server error'));
      }, []);

      const handleRemoveUser = (username) => {
        fetch(`${API_URL}/admin/users/${username}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        })
          .then(res => res.json())
          .then(data => {
            if (data.message) {
              setUsers(users.filter(user => user.username !== username));
            } else {
              setError(data.error || 'Failed to remove user');
            }
          })
          .catch(() => setError('Server error'));
      };

      return (
        <div>
          <h2 className="text-xl mb-4 text-center">Admin Panel</h2>
          {error && <p className="text-red-500 mb-4">{error}</p>}
          <button
            onClick={() => setMode('welcome')}
            className="mb-4 p-2 bg-blue-600 rounded hover:bg-blue-700"
          >
            Back to Welcome
          </button>
          <h3 className="text-lg mb-2">Users</h3>
          <ul className="space-y-2">
            {users.map(user => (
              <li key={user.username} className="flex justify-between items-center bg-gray-800 p-2 rounded">
                <span>{user.username} ({user.email})</span>
                <button
                  onClick={() => handleRemoveUser(user.username)}
                  className="p-1 bg-red-600 rounded hover:bg-red-700"
                >
                  Remove
                </button>
              </li>
            ))}
          </ul>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>